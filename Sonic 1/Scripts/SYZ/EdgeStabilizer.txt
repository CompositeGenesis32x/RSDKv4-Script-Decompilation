// ----------------------------------
// RSDK Project: Sonic 1
// Script Description: Edge Stabilizer Object
// Script Author: Christian Whitehead/Simon Thomley
// Unpacked by Rubberduckycooly's script unpacker
// ----------------------------------

// The object name is a bit odd so I'll just clarify here - 
// This object's purpose is to make the player not sink at the edge of a triangle chunk
// Well I suppose that's an equally as odd description, but since images are worth a thousand words, it's meant to prevent things like this
// https://randomsonicnet.org/taxman_sage2007/collisionbug.png

// ========================
// Aliases
// ========================

// Player Aliases
private alias object.ypos : player.ypos
private alias object.gravity : player.gravity
private alias object.collisionBottom : player.collisionBottom


// ========================
// Events
// ========================

event ObjectMain
	foreach (GROUP_PLAYERS, currentPlayer, ACTIVE_ENTITIES)
		if player[currentPlayer].gravity == GRAVITY_GROUND
			BoxCollisionTest(C_TOUCH, object.entityPos, -8, -8, 8, 8, currentPlayer, HITBOX_AUTO, HITBOX_AUTO, HITBOX_AUTO, HITBOX_AUTO)
			if checkResult == true
				temp0 = player[currentPlayer].collisionBottom
				temp0 *= -0x10000
				temp0 -= 0x80000
				temp0 += object.ypos
				if player[currentPlayer].ypos > temp0
					player[currentPlayer].ypos = temp0
				end if
			end if
		end if
	next
end event


// ========================
// Editor Events
// ========================

event RSDKDraw
	DrawSprite(0)

	if editor.showGizmos == true
		// Draw the sensor hitbox
		temp0 = object.xpos; temp0 -= 0x80000
		temp1 = object.ypos; temp1 -= 0x80000
		DrawRectOutline(temp0, temp1, 0x100000, 0x100000, 255, 255, 255, 255)
	end if
end event


event RSDKLoad
	LoadSpriteSheet("Global/Display.gif")
	SpriteFrame(-8, -8, 16, 16, 239, 239) // "Trigger" - #0
	
	SetVariableAlias(ALIAS_VAR_PROPVAL, "unused")
end event
