// ----------------------------------
// RSDK Project: Sonic 1
// Script Description: MissionWater Object
// Script Author: Christian Whitehead/Simon Thomley
// Unpacked by Rubberduckycooly's script unpacker
// ----------------------------------

// ========================
// Aliases
// ========================
private alias 87 : TYPE_MISSIONWATER

// ========================
// Function Declarations
// ========================
reserve function AirBubbler_Function115
reserve function AirBubbler_Function116
reserve function CountdownBubble_Function116
reserve function Burrobot_Function117
reserve function Burrobot_Function118
reserve function Jaws_Function119
reserve function Jaws_Function120
reserve function Orbinaut_Function121
reserve function Orbinaut_Function122
reserve function Orbinaut_Function123
reserve function Orbinaut_Function124
reserve function Orbinaut_Function125
reserve function Pecky_Function126
reserve function Pecky_Function127
reserve function Rocky_Function128
reserve function Rocky_Function129
reserve function HarpoonH_Function130
reserve function HarpoonH_Function131
reserve function HarpoonV_Function132
reserve function HarpoonV_Function133
reserve function Gargoyle_Function134
reserve function Gargoyle_Function135
reserve function Wheel_Function136
reserve function Wheel_Function137
reserve function RotatingSpike_Function138
reserve function RotatingSpike_Function139
reserve function Waterfall_Function140
reserve function Waterfall_Function141
reserve function FlappingDoor_Function142
reserve function FlappingDoor_Function143
reserve function PushButton_Function144
reserve function PushButton_Function145
reserve function SolidBlock_Function146
reserve function SolidBlock_Function147
reserve function MovingBlock_Function148
reserve function MovingBlock_Function149
reserve function Door_Function150
reserve function Door_Function151
reserve function Cork_Function152
reserve function Cork_Function153
reserve function DoorHorizontal_Function154
reserve function DoorHorizontal_Function155
reserve function BeltPlatform_Function156
reserve function RisingPlatform_Function157
reserve function RisingPlatform_Function158
reserve function PushBlock_Function159
reserve function PushBlock_Function160
reserve function PushBlock_Function161
reserve function PushBlock_Function162
reserve function PushBlock_Function163
reserve function TouchBlock_Function164
reserve function TouchBlock_Function165
reserve function FallingBlock_Function166
reserve function FallingBlock_Function167
reserve function Eggman_Function168
reserve function Eggman_Function169
reserve function GrabBar_Function170
reserve function GrabBar_Function171
reserve function InvisibleBlock_Function172
reserve function InvisibleBlock_Function173
reserve function SlidingFloor_Function174
reserve function SlidingFloor_Function175
reserve function MissionWater_Function176
reserve function MissionWater_Function177

// ========================
// Static Values
// ========================

// ========================
// Tables
// ========================

//Unknown Variables
private value value0x16BC2 = 0;
private value value0x16BC3 = 0;

public function AirBubbler_Function116
	DrawSprite(0)
end function


public function CountdownBubble_Function116
	CreateTempObject(TypeName[Air Bubbler], 0, object.xpos, object.ypos)
	object[tempObjectPos].drawOrder = 4
	object[tempObjectPos].value4 = 0
end function


public function Burrobot_Function117
	DrawSpriteFX(3, FX_FLIP, object.xpos, object.ypos)
end function


public function Burrobot_Function118
	CreateTempObject(TypeName[Burrobot], 0, object.xpos, object.ypos)
	object[tempObjectPos].direction = object.direction
	if object[tempObjectPos].direction == 0
		object[tempObjectPos].xvel = -0x8000
	else
		object[tempObjectPos].xvel = 0x8000
	end if
	object[tempObjectPos].value0 = object.xpos
	object[tempObjectPos].value1 = object.ypos
	object[tempObjectPos].yvel = -0x40000
	object[tempObjectPos].animation = 1
	object[tempObjectPos].state = 1
end function


public function Jaws_Function119
	DrawSpriteFX(0, FX_FLIP, object.xpos, object.ypos)
end function


public function Jaws_Function120
	CreateTempObject(TypeName[Jaws], 0, object.xpos, object.ypos)
	object[tempObjectPos].direction = object.direction
	object[tempObjectPos].value3 = object.xpos
	if object[tempObjectPos].direction == 0
		object[tempObjectPos].xvel = -0x4000
	else
		object[tempObjectPos].xvel = 0x4000
	end if
	object[tempObjectPos].value0 = 120
end function


public function Orbinaut_Function121
	temp0 = object.value17
	temp0 -= Orbinaut_value34
	temp0--
	temp0 ^= 1
	temp0 <<= 1
	DrawSpriteFX(temp0, FX_FLIP, object.xpos, object.ypos)
end function


public function Orbinaut_Function122
	temp0 = object.value17
	temp0 -= Orbinaut_value34
	CreateTempObject(TypeName[Orbinaut], temp0, object.xpos, object.ypos)
	object[tempObjectPos].value2 = object[tempObjectPos].xpos
	object[tempObjectPos].value1 = 15
	if object[tempObjectPos].propertyValue > 1
		object[tempObjectPos].value3 = 0
		object[tempObjectPos].propertyValue &= 1
		GetBit(temp0, object.direction, 0)
		if temp0 == 0
			object[tempObjectPos].direction = 0
			object[tempObjectPos].xvel = -0x4000
		else
			object[tempObjectPos].direction = 1
			object[tempObjectPos].xvel = 0x4000
		end if
	else
		object[tempObjectPos].value3 = 1
		object[tempObjectPos].xvel = 0
		GetBit(temp0, object.direction, 0)
		if temp0 == 0
			object[tempObjectPos].direction = 0
		else
			object[tempObjectPos].direction = 1
		end if
	end if
end function


public function Orbinaut_Function123
	temp0 = 0
	temp7 = object.angle
	temp1 = object.xpos
	temp2 = object.ypos
	while temp0 < 4
		GetBit(temp6, object.value1, temp0)
		if temp6 == 1
			Cos256(object.xpos, temp7)
			object.xpos <<= 12
			object.xpos += temp1
			Sin256(object.ypos, temp7)
			object.ypos <<= 12
			object.ypos += temp2
			foreach (GROUP_PLAYERS, currentPlayer, ACTIVE_ENTITIES)
				BoxCollisionTest(C_TOUCH, object.entityPos, -4, -4, 4, 4, currentPlayer, C_BOX, C_BOX, C_BOX, C_BOX)
				if checkResult == 1
					CallFunction(PlayerObject_Hit)
				end if
			next
		end if
		temp7 += 64
		temp7 &= 255
		temp0++
	loop
	object.xpos = temp1
	object.ypos = temp2
	foreach (GROUP_PLAYERS, currentPlayer, ACTIVE_ENTITIES)
		BoxCollisionTest(C_TOUCH, object.entityPos, -8, -8, 8, 8, currentPlayer, object[currentPlayer].value40, object[currentPlayer].value38, object[currentPlayer].value41, object[currentPlayer].value39)
		if checkResult == 1
			CallFunction(PlayerObject_BadnikBreak)
		end if
	next
end function


public function Orbinaut_Function124
	foreach (GROUP_PLAYERS, currentPlayer, ACTIVE_ENTITIES)
		BoxCollisionTest(C_TOUCH, object.entityPos, -4, -4, 4, 4, currentPlayer, C_BOX, C_BOX, C_BOX, C_BOX)
		if checkResult == 1
			CallFunction(PlayerObject_Hit)
		end if
	next
end function


public function Orbinaut_Function125
	if object.outOfBounds == 1
		temp0 = object.xpos
		object.xpos = object.value2
		if object.outOfBounds == 1
			object.xpos = object.value2
			object.value1 = 15
			if object.value3 == 0
				if object.propertyValue == 0
					object.direction = 0
					object.xvel = -0x4000
				else
					object.direction = 1
					object.xvel = 0x4000
				end if
			else
				if object.propertyValue == 0
					object.direction = 0
				else
					object.direction = 1
				end if
				object.xvel = 0
			end if
			object.value0 = 0
			object.animationTimer = 0
			object.priority = 0
			object.state = 0
			object.angle = 0
		else
			object.xpos = temp0
		end if
	end if
end function


public function Pecky_Function126
	DrawSprite(2)
end function


public function Pecky_Function127
	CreateTempObject(TypeName[Pecky], 0, object.xpos, object.ypos)
	GetBit(temp0, object.direction, 0)
	if temp0 == 0
		object[tempObjectPos].state = 3
		object[tempObjectPos].xvel = 0x18000
		object[tempObjectPos].yvel = -0x30000
		Rand(checkResult, 32)
		if checkResult < 16
			object[tempObjectPos].direction = 1
			FlipSign(object[tempObjectPos].xvel)
		end if
	else
		object[tempObjectPos].state = 4
	end if
end function


public function Rocky_Function128
	DrawSprite(2)
end function


public function Rocky_Function129
	CreateTempObject(TypeName[Rocky], 0, object.xpos, object.ypos)
	GetBit(temp0, object.direction, 0)
	if temp0 == 0
		object[tempObjectPos].state = 3
		object[tempObjectPos].xvel = 0x14000
		object[tempObjectPos].yvel = -0x18000
		Rand(checkResult, 32)
		if checkResult < 16
			object[tempObjectPos].direction = 1
			FlipSign(object[tempObjectPos].xvel)
		end if
	else
		object[tempObjectPos].state = 4
	end if
end function


public function HarpoonH_Function130
	DrawSpriteFX(0, FX_FLIP, object.xpos, object.ypos)
end function


public function HarpoonH_Function131
	CreateTempObject(TypeName[Harpoon H], 0, object.xpos, object.ypos)
	object[tempObjectPos].direction = object.direction
end function


public function HarpoonV_Function132
	temp0 = object.direction
	if object.direction == 1
		object.direction = 2
	end if
	DrawSpriteFX(0, FX_FLIP, object.xpos, object.ypos)
	object.direction = temp0
end function


public function HarpoonV_Function133
	CreateTempObject(TypeName[Harpoon V], 0, object.xpos, object.ypos)
	object[tempObjectPos].direction = object.direction
	object[tempObjectPos].direction <<= 1
end function


public function Gargoyle_Function134
	DrawSpriteFX(0, FX_FLIP, object.xpos, object.ypos)
end function


public function Gargoyle_Function135
	CreateTempObject(TypeName[Gargoyle], 0, object.xpos, object.ypos)
	object[tempObjectPos].direction = object.direction
	object[tempObjectPos].value1 = 60
	object[tempObjectPos].value0 = 60
end function


public function Wheel_Function136
	DrawSpriteFX(0, FX_FLIP, object.xpos, object.ypos)
end function


public function Wheel_Function137
	CreateTempObject(TypeName[Wheel], 0, object.xpos, object.ypos)
	object[tempObjectPos].drawOrder = 4
end function


public function RotatingSpike_Function138
	temp7 = object[0].value17
	temp7 -= RotatingSpike_value35
	temp6 = object.direction
	temp6 <<= 8
	DrawSprite(0)
	temp0 = 0
	temp1 = 16
	while temp0 < temp7
		Cos(temp2, temp6)
		temp2 *= temp1
		temp2 <<= 7
		temp2 += object.xpos
		Sin(temp3, temp6)
		temp3 *= temp1
		temp3 <<= 7
		temp3 += object.ypos
		DrawSpriteXY(1, temp2, temp3)
		temp0++
		temp1 += 16
	loop
	Cos(temp2, temp6)
	temp2 *= temp1
	temp2 <<= 7
	temp2 += object.xpos
	Sin(temp3, temp6)
	temp3 *= temp1
	temp3 <<= 7
	temp3 += object.ypos
	DrawSpriteXY(2, temp2, temp3)
end function


public function RotatingSpike_Function139
	CreateTempObject(TypeName[Rotating Spike], 0, object.xpos, object.ypos)
	object[tempObjectPos].value0 = object.direction
	object[tempObjectPos].value0 <<= 16
	if object.direction == 0
		object[tempObjectPos].value1 = 256
	else
		object[tempObjectPos].value1 = -256
	end if
	object[tempObjectPos].value2 = object[0].value17
	object[tempObjectPos].value2 -= RotatingSpike_value35
	object[tempObjectPos].value2++
	object[tempObjectPos].value3 = object[tempObjectPos].value2
	object[tempObjectPos].value3 <<= 4
end function


public function Waterfall_Function140
	temp0 = object[0].value17
	temp0 -= Waterfall_value36
	DrawSpriteFX(temp0, FX_FLIP, object.xpos, object.ypos)
end function


public function Waterfall_Function141
	temp0 = object[0].value17
	temp0 -= Waterfall_value36
	CreateTempObject(TypeName[Waterfall], temp0, object.xpos, object.ypos)
	object[tempObjectPos].direction = object.direction
	object[tempObjectPos].drawOrder = 4
	if object[tempObjectPos].propertyValue == 9
		object[tempObjectPos].frame = 9
	end if
end function


public function FlappingDoor_Function142
	DrawSpriteFX(0, FX_FLIP, object.xpos, object.ypos)
end function


public function FlappingDoor_Function143
	CreateTempObject(TypeName[Flapping Door], 0, object.xpos, object.ypos)
	object[tempObjectPos].direction = object.direction
	object[tempObjectPos].value1 = 56
	object[tempObjectPos].value0 = 56
end function


public function PushButton_Function144
	DrawSprite(0)
end function


public function PushButton_Function145
	CreateTempObject(TypeName[Push Button], 0, object.xpos, object.ypos)
end function


public function SolidBlock_Function146
	DrawSprite(0)
end function


public function SolidBlock_Function147
	CreateTempObject(TypeName[Solid Block], 0, object.xpos, object.ypos)
end function


public function MovingBlock_Function148
	DrawSprite(0)
end function


public function MovingBlock_Function149
	CreateTempObject(TypeName[Moving Block], 0, object.xpos, object.ypos)
	object[tempObjectPos].priority = 3
	object[tempObjectPos].state = 1
end function


public function Door_Function150
	DrawSprite(0)
end function


public function Door_Function151
	CreateTempObject(TypeName[Door], 0, object.xpos, object.ypos)
	object[tempObjectPos].priority = 1
	object[tempObjectPos].value0 = 32
end function


public function Cork_Function152
	DrawSprite(0)
end function


public function Cork_Function153
	CreateTempObject(TypeName[Cork], 0, object.xpos, object.ypos)
	object[tempObjectPos].ypos &= -0x10000
	GetBit(temp0, object.ypos, 16)
	if temp0 == 1
		object[tempObjectPos].ypos++
	end if
	object[tempObjectPos].drawOrder = 4
end function


public function DoorHorizontal_Function154
	DrawSprite(0)
end function


public function DoorHorizontal_Function155
	CreateTempObject(TypeName[Door Horizontal], 0, object.xpos, object.ypos)
	object[tempObjectPos].direction = object.direction
	object[tempObjectPos].priority = 1
	object[tempObjectPos].value0 = 64
end function


public function BeltPlatform_Function156
	temp0 = object[arrayPos0].value5
	GetTableValue(object[arrayPos0].value0, temp0, object[arrayPos0].value4)
	temp0++
	GetTableValue(object[arrayPos0].value1, temp0, object[arrayPos0].value4)
	temp0 = object[arrayPos0].ixpos
	temp0 -= object[arrayPos0].value0
	Abs(temp0)
	temp1 = object[arrayPos0].iypos
	temp1 -= object[arrayPos0].value1
	Abs(temp1)
	if temp1 < temp0
		object[arrayPos0].xvel = 0x10000
		temp1 <<= 16
		object[arrayPos0].yvel = temp1
		object[arrayPos0].yvel /= temp0
	else
		if temp1 != 0
			temp0 <<= 16
			object[arrayPos0].xvel = temp0
			object[arrayPos0].xvel /= temp1
		else
			object[arrayPos0].xvel = 0
		end if
		object[arrayPos0].yvel = 0x10000
	end if
	if object[arrayPos0].value0 < object[arrayPos0].ixpos
		FlipSign(object[arrayPos0].xvel)
	end if
	if object[arrayPos0].value1 < object[arrayPos0].iypos
		FlipSign(object[arrayPos0].yvel)
	end if
end function


public function RisingPlatform_Function157
	DrawSprite(0)
end function


public function RisingPlatform_Function158
	CreateTempObject(TypeName[Rising Platform], 0, object.xpos, object.ypos)
	object[tempObjectPos].value3 = object.ypos
	object[tempObjectPos].drawOrder = 4
end function


public function PushBlock_Function159
	temp0 = object[0].value17
	temp0 -= PushBlock_value37
	DrawSprite(temp0)
end function


public function PushBlock_Function160
	CreateTempObject(TypeName[Push Block], 0, object.xpos, object.ypos)
	object[tempObjectPos].value6 = 0
	object[tempObjectPos].frame = object[0].value17
	object[tempObjectPos].frame -= PushBlock_value37
	if object[tempObjectPos].frame == 0
		object[tempObjectPos].value2 = -16
		object[tempObjectPos].value3 = 16
		object[tempObjectPos].value4 = -17
		object[tempObjectPos].value5 = 17
	else
		object[tempObjectPos].value2 = -64
		object[tempObjectPos].value3 = 64
		object[tempObjectPos].value4 = -65
		object[tempObjectPos].value5 = 65
		object[tempObjectPos].drawOrder = 5
	end if
end function


public function PushBlock_Function161
	if object.floorSensorC == 0
		if object.floorSensorL == 0
			object.xvel = -0x40000
			object.value9 = object.xpos
			object.value9 &= -0x100000
			object.state++
		else
			if object.floorSensorR == 0
				object.xvel = 0x40000
				object.value9 = object.xpos
				object.value9 &= -0x100000
				object.value9 += 0x100000
				object.state++
			end if
		end if
	end if
end function


public function PushBlock_Function162
	object.value10 = 0
	temp2 = 0
	object.xvel = 0
	foreach (GROUP_PLAYERS, currentPlayer, ACTIVE_ENTITIES)
		CheckEqual(options.attractMode, 1)
		temp1 = checkResult
		CheckEqual(currentPlayer, 1)
		temp1 &= checkResult
		if object[currentPlayer].gravity == 0
			if object[currentPlayer].xvel < 0
				BoxCollisionTest(C_TOUCH, object.entityPos, 0, -12, object.value5, 12, currentPlayer, C_BOX, C_BOX, C_BOX, C_BOX)
				if checkResult == 1
					if object[currentPlayer].left == 1
						if temp1 == 0
							SetBit(object.value10, temp2, 1)
							object.xvel -= 0x6000
							object.value6 = 1
						end if
					end if
					object[currentPlayer].xpos = object[currentPlayer].collisionRight
					object[currentPlayer].xpos += object.value3
					object[currentPlayer].xpos <<= 16
					object[currentPlayer].xpos += object.value1
					object[currentPlayer].xvel = 0
					object[currentPlayer].speed = 0
					object[currentPlayer].pushing = 2
				end if
			else
				if object[currentPlayer].xvel > 0
					BoxCollisionTest(C_TOUCH, object.entityPos, object.value4, -12, 0, 12, currentPlayer, C_BOX, C_BOX, C_BOX, C_BOX)
					if checkResult == 1
						if object[currentPlayer].right == 1
							if temp1 == 0
								SetBit(object.value10, temp2, 1)
								object.xvel += 0x6000
								object.value6 = 1
							end if
						end if
						object[currentPlayer].xpos = object[currentPlayer].collisionLeft
						object[currentPlayer].xpos += object.value2
						object[currentPlayer].xpos <<= 16
						object[currentPlayer].xpos += object.value1
						object[currentPlayer].xvel = 0
						object[currentPlayer].speed = 0
						object[currentPlayer].pushing = 2
					end if
				else
					BoxCollisionTest(C_SOLID, object.entityPos, object.value2, -16, object.value3, 16, currentPlayer, C_BOX, C_BOX, C_BOX, C_BOX)
				end if
			end if
		else
			BoxCollisionTest(C_SOLID, object.entityPos, object.value2, -16, object.value3, 16, currentPlayer, C_BOX, C_BOX, C_BOX, C_BOX)
		end if
		temp2++
	next
	if object.xvel != 0
		object.xpos += object.xvel
		if object.xvel < 0
			ObjectTileCollision(2, object.value2, 0, 0)
		else
			ObjectTileCollision(1, object.value3, 0, 0)
		end if
		CallFunction(PushBlock_Function161)
		temp0 = object.xpos
		temp0 &= -0x10000
		if object.value1 != temp0
			temp0 = oscillation
			temp0 &= 31
			if temp0 < 3
				PlaySfx(SfxName[Push Block], 0)
			end if
		end if
	end if
	object.value1 = object.xpos
	object.value1 &= -0x10000
	temp2 = 0
	foreach (GROUP_PLAYERS, currentPlayer, ACTIVE_ENTITIES)
		GetBit(temp0, object.value10, temp2)
		if temp0 == 1
			if object[currentPlayer].xpos < object.xpos
				object[currentPlayer].ixpos = object[currentPlayer].collisionRight
				temp1 = object.value2
			else
				object[currentPlayer].ixpos = object[currentPlayer].collisionLeft
				temp1 = object.value3
			end if
			FlipSign(object[currentPlayer].xpos)
			temp1 <<= 16
			object[currentPlayer].xpos += temp1
			object[currentPlayer].xpos += object.xpos
		else
			BoxCollisionTest(C_SOLID, object.entityPos, object.value2, -16, object.value3, 16, currentPlayer, C_BOX, C_BOX, C_BOX, C_BOX)
		end if
		temp2++
	next
end function


public function PushBlock_Function163
	if object.value6 == 1
		if object.gravity == 1
			object.yvel += 0x1800
			object.ypos += object.yvel
			temp0 = object.value2
			temp0 += 2
			ObjectTileCollision(0, temp0, 16, 0)
			object.floorSensorL = checkResult
			object.gravity = checkResult
			ObjectTileCollision(0, 0, 16, 0)
			object.floorSensorC = checkResult
			object.gravity |= checkResult
			temp0 = object.value3
			temp0 -= 2
			ObjectTileCollision(0, temp0, 16, 0)
			object.floorSensorR = checkResult
			object.gravity |= checkResult
		else
			object.yvel = 0
			temp0 = object.value2
			temp0 += 2
			ObjectTileGrip(0, temp0, 16, 0)
			object.floorSensorL = checkResult
			object.gravity = checkResult
			ObjectTileGrip(0, 0, 16, 0)
			object.floorSensorC = checkResult
			object.gravity |= checkResult
			temp0 = object.value3
			temp0 -= 2
			ObjectTileGrip(0, temp0, 16, 0)
			object.floorSensorR = checkResult
			object.gravity |= checkResult
		end if
		object.gravity ^= 1
	else
		object.floorSensorL = 1
		object.floorSensorC = 1
		object.floorSensorR = 1
	end if
end function


public function TouchBlock_Function164
	DrawSprite(0)
end function


public function TouchBlock_Function165
	CreateTempObject(TypeName[Touch Block], 0, object.xpos, object.ypos)
	object[tempObjectPos].value3 = object.ypos
end function


public function FallingBlock_Function166
	DrawSprite(0)
end function


public function FallingBlock_Function167
	CreateTempObject(TypeName[Falling Block], 0, object.xpos, object.ypos)
	object[tempObjectPos].value3 = object.ypos
end function


public function Eggman_Function168
	Sin256(temp0, object.value3)
	temp0 <<= 10
	object.ypos += temp0
	object.value3 += 2
	object.value3 &= 255
end function


public function Eggman_Function169
	object.value0 += object.xvel
	object.value1 += object.yvel
	object.xpos = object.value0
	object.ypos = object.value1
end function


public function GrabBar_Function170
	DrawSprite(0)
end function


public function GrabBar_Function171
	CreateTempObject(TypeName[Grab Bar], 0, object.xpos, object.ypos)
	object[tempObjectPos].value0 = 60
end function


public function InvisibleBlock_Function172
	temp0 = object.xpos
	temp1 = object.ypos
	temp0 -= 0x80000
	temp1 -= 0x80000
	DrawSpriteXY(0, temp0, temp1)
	temp0 += 0x100000
	DrawSpriteXY(0, temp0, temp1)
	temp0 -= 0x100000
	temp1 += 0x100000
	DrawSpriteXY(0, temp0, temp1)
	temp0 += 0x100000
	DrawSpriteXY(0, temp0, temp1)
end function


public function InvisibleBlock_Function173
	CreateTempObject(TypeName[Invisible Block], 17, object.xpos, object.ypos)
	object[tempObjectPos].drawOrder = 5
	object[tempObjectPos].value0 = 16
	object[tempObjectPos].value1 = 16
end function


public function SlidingFloor_Function174
	DrawSprite(0)
end function


public function SlidingFloor_Function175
	CreateTempObject(TypeName[Sliding Floor], 0, object.xpos, object.ypos)
end function


public function MissionWater_Function176
	if object[+0].value1 > 0
		object[+0].value1--
		if object[+0].value2 > 0
			object[+0].value2--
		else
			CreateTempObject(TypeName[Air Bubble], 2, object[0].xpos, object[0].ypos)
			object[tempObjectPos].drawOrder = 4
			object[tempObjectPos].yvel = -0x8800
			object[tempObjectPos].value2 = 0
			if object[0].direction == 0
				object[tempObjectPos].xpos += 0x60000
			else
				object[tempObjectPos].xpos -= 0x60000
				object[tempObjectPos].angle = 256
			end if
			object[tempObjectPos].value1 = object[tempObjectPos].xpos
			object[+0].value2 = 512
		end if
	else
		Rand(temp0, 3)
		if temp0 == 1
			Rand(object[+0].value2, 16)
			object[+0].value2 += 8
		else
			object[+0].value2 = 512
		end if
		object[+0].value1 = 60
		CreateTempObject(TypeName[Air Bubble], 2, object[0].xpos, object[0].ypos)
		object[tempObjectPos].drawOrder = 4
		object[tempObjectPos].yvel = -0x8800
		object[tempObjectPos].value2 = 0
		if object[0].direction == 0
			object[tempObjectPos].xpos += 0x60000
		else
			object[tempObjectPos].xpos -= 0x60000
			object[tempObjectPos].angle = 256
		end if
		object[tempObjectPos].value1 = object[tempObjectPos].xpos
	end if
end function


public function MissionWater_Function177
	CreateTempObject(TypeName[Countdown Bubble], temp0, object[0].xpos, object[0].ypos)
	object[tempObjectPos].drawOrder = 5
	object[tempObjectPos].yvel = -0x8800
	object[tempObjectPos].value2 = 0
	if object[0].direction == 0
		object[tempObjectPos].xpos += 0x60000
	else
		object[tempObjectPos].xpos -= 0x60000
		object[tempObjectPos].angle = 256
	end if
	object[tempObjectPos].value1 = object[tempObjectPos].xpos
end function


public function AirBubbler_Function115
	arrayPos0 = Water_value31
	arrayPos0 += 0
	if object[0].type != TypeName[Death Event]
		if music.currentTrack == 6
			if object[arrayPos0].value8 == 2
				arrayPos1 = 0
				arrayPos1 += playerCount
				if object[arrayPos1].type != TypeName[Invincibility]
					if PlayerObject_value0 != 1
						object[arrayPos0].value8 = 0
					end if
				end if
			end if
			PlayMusic(object[arrayPos0].value8)
		end if
	end if
end function


event ObjectUpdate
	if object.ypos < stage.newWaterLevel
		object.ypos += 0x10000
	end if
	if object.ypos > stage.newWaterLevel
		object.ypos -= 0x10000
	end if
	temp0 = oscillation
	temp0 <<= 1
	Sin(stage.waterLevel, temp0)
	stage.waterLevel <<= 10
	stage.waterLevel += object.ypos
	temp7 = stage.waterLevel
	stage.waterLevel >>= 16
	if stage.timeEnabled == 0
		if object[0].type == TypeName[Player Object]
			object[0].value3 = 0
		end if
		if object[0].type == TypeName[Death Event]
			object[0].value4 = 11
		end if
	end if
	if object[0].value25 == 0x3800
		CheckNotEqual(object[0].type, TypeName[Debug Mode])
		temp0 = checkResult
		CheckNotEqual(object[0].state, 27)
		temp0 &= checkResult
		CheckGreater(object[0].ypos, temp7)
		temp0 &= checkResult
		if temp0 == 1
			if object[0].yvel > 0
				object[0].yvel >>= 2
			end if
			if object.ypos < stage.newWaterLevel
				object[0].yvel += 0x10000
			end if
			if object[0].state == 18
				StopSfx(SfxName[Flying])
				StopSfx(SfxName[Jump])
			end if
			object[0].xvel >>= 1
			object[0].speed >>= 1
			CallFunction(PlayerObject_Function46)
			if object[0].yvel != 0
				CreateTempObject(TypeName[Water Splash], 0, object[0].xpos, temp7)
				object[tempObjectPos].drawOrder = 4
				PlaySfx(SfxName[Water Splash], 0)
			end if
			object[+0].value1 = 52
			object[0].value3 = 0
		end if
	else
		if object[0].value37 == 3
			temp2 = 0
			while temp2 < 8
				Rand(temp0, 32)
				Rand(temp1, 32)
				temp0 -= 16
				temp0 <<= 16
				temp0 += object[0].xpos
				temp1 -= 16
				temp1 <<= 16
				temp1 += object[0].ypos
				CreateTempObject(TypeName[Dust Puff], 0, temp0, temp1)
				object[tempObjectPos].drawOrder = object[0].value18
				object[tempObjectPos].drawOrder++
				object[tempObjectPos].xvel = object[0].xvel
				object[tempObjectPos].yvel = object[0].yvel
				temp2++
			loop
			object[0].value37 = 0
			arrayPos0 = 0
			arrayPos0 += playerCount
			CallFunction(PlayerObject_Function42)
		end if
		if object[0].value37 == 4
			object[0].value37 = 0
			arrayPos0 = 0
			arrayPos0 += playerCount
			CallFunction(PlayerObject_Function42)
			LZSetup_value29 = 4
		end if
		if object[0].value37 != 2
			if object[0].value3 == 0
				object[0].value4 = 0
				CallFunction(AirBubbler_Function115)
			end if
			switch object[0].value4
			case 0
				CallFunction(MissionWater_Function176)
				object[0].value3++
				if object[0].value3 == 360
					if 0 == 0
						PlaySfx(SfxName[Drown Alert], 0)
					end if
					object[0].value4++
				end if
				break
			case 1
				CallFunction(MissionWater_Function176)
				object[0].value3++
				if object[0].value3 == 660
					if 0 == 0
						PlaySfx(SfxName[Drown Alert], 0)
					end if
					object[0].value4++
				end if
				break
			case 2
				CallFunction(MissionWater_Function176)
				object[0].value3++
				if object[0].value3 == 960
					if 0 == 0
						PlaySfx(SfxName[Drown Alert], 0)
					end if
					object[0].value4++
				end if
				break
			case 3
				CallFunction(MissionWater_Function176)
				object[0].value3++
				if object[0].value3 == 0x438
					if 0 == 0
						object.value8 = music.currentTrack
						PlayMusic(6)
					end if
					temp0 = 0
					CallFunction(MissionWater_Function177)
					object[0].value4++
				end if
				break
			case 4
				CallFunction(MissionWater_Function176)
				object[0].value3++
				if object[0].value3 == 0x4B0
					temp0 = 1
					CallFunction(MissionWater_Function177)
					object[0].value4++
				end if
				break
			case 5
				CallFunction(MissionWater_Function176)
				object[0].value3++
				if object[0].value3 == 0x528
					temp0 = 2
					CallFunction(MissionWater_Function177)
					object[0].value4++
				end if
				break
			case 6
				CallFunction(MissionWater_Function176)
				object[0].value3++
				if object[0].value3 == 0x5A0
					temp0 = 3
					CallFunction(MissionWater_Function177)
					object[0].value4++
				end if
				break
			case 7
				CallFunction(MissionWater_Function176)
				object[0].value3++
				if object[0].value3 == 0x618
					temp0 = 4
					CallFunction(MissionWater_Function177)
					object[0].value4++
				end if
				break
			case 8
				CallFunction(MissionWater_Function176)
				object[0].value3++
				if object[0].value3 == 0x690
					temp0 = 5
					CallFunction(MissionWater_Function177)
					object[0].value4++
				end if
				break
			case 9
				CallFunction(MissionWater_Function176)
				object[0].value3++
				if object[0].value3 == 0x708
					if object[0].state != 27
						if 0 == 0
							stage.timeEnabled = 0
							camera[0].enabled = 0
						end if
						object[0].state = 28
						object[0].animation = ANI_DROWNING
						object[0].speed = 0
						object[0].xvel = 0
						object[0].yvel = 0
						object[0].tileCollisions = 0
						object[0].interaction = 0
						object[0].value18 = 5
						object[+0].value1 = 2
						PlaySfx(SfxName[Drowning], 0)
						object[0].value4++
					end if
				end if
				break
			case 10
				object[0].value3++
				if object[0].value3 == 0x744
					object[0].value4++
				end if
				if object[+0].value1 > 0
					object[+0].value1--
					if object[+0].value2 > 0
						object[+0].value2--
					else
						Rand(temp1, 2)
						temp1 += 2
						CreateTempObject(TypeName[Air Bubble], temp1, object[0].xpos, object[0].ypos)
						object[tempObjectPos].drawOrder = 5
						object[tempObjectPos].yvel = -0x8800
						object[tempObjectPos].ypos -= 0x60000
						object[tempObjectPos].value2 = 0
						Rand(object[tempObjectPos].angle, 256)
						object[tempObjectPos].value1 = object[tempObjectPos].xpos
						object[+0].value2 = 512
					end if
				else
					Rand(temp0, 5)
					if temp0 == 1
						object[+0].value2 = 2
					else
						object[+0].value2 = 512
					end if
					object[+0].value1 = 6
					Rand(temp1, 2)
					temp1 += 2
					CreateTempObject(TypeName[Air Bubble], temp1, object[0].xpos, object[0].ypos)
					object[tempObjectPos].drawOrder = 5
					object[tempObjectPos].yvel = -0x8800
					object[tempObjectPos].ypos -= 0x60000
					object[tempObjectPos].value2 = 0
					Rand(object[tempObjectPos].angle, 256)
					object[tempObjectPos].value1 = object[tempObjectPos].xpos
				end if
				break
			end switch
		end if
		CheckEqual(object[0].type, TypeName[Debug Mode])
		temp0 = checkResult
		CheckLower(object[0].ypos, temp7)
		temp0 |= checkResult
		if temp0 == 1
			if object[0].state != 27
				object[0].yvel <<= 1
				if object[0].yvel < -0x100000
					object[0].yvel = -0x100000
				end if
				if object[0].animation == ANI_JUMPING
					if object[0].value1 > 0
						if object[0].yvel < -0x68000
							object[0].yvel = -0x68000
						end if
					end if
				end if
				if object[0].state == 18
					if object[0].value1 < 480
						PlaySfx(SfxName[Flying], 1)
					else
						PlaySfx(SfxName[Jump], 1)
					end if
				end if
				CallFunction(PlayerObject_Function46)
				if object[0].yvel != 0
					temp0 = object.ypos
					temp0 -= object[0].ypos
					if temp0 < 0xF00000
						CreateTempObject(TypeName[Water Splash], 0, object[0].xpos, temp7)
						object[tempObjectPos].drawOrder = 4
						PlaySfx(SfxName[Water Splash], 0)
					end if
				end if
				object[0].value3 = 0
				CallFunction(AirBubbler_Function115)
			end if
		end if
	end if
	object.animationTimer++
	object.animationTimer %= 24
	object.frame = object.animationTimer
	object.frame >>= 3
end event


event ObjectDraw
	temp0 = screen.xoffset
	Sin(temp1, oscillation)
	temp1 >>= 5
	temp0 += temp1
	temp0 &= 63
	FlipSign(temp0)
	temp1 = stage.waterLevel
	temp1 -= screen.yoffset
	DrawSpriteScreenFX(object.frame, FX_INK, temp0, temp1)
	temp0 += 256
	DrawSpriteScreenFX(object.frame, FX_INK, temp0, temp1)
end event


event ObjectStartup
	LoadSpriteSheet("LZ/Objects2.gif")
	foreach (TypeName[MissionWater], arrayPos0, ALL_ENTITIES)
		object[arrayPos0].priority = 1
		object[arrayPos0].drawOrder = 5
		object[arrayPos0].inkEffect = 2
		object[arrayPos0].alpha = 160
		stage.newWaterLevel = object[arrayPos0].ypos
		Water_value31 = arrayPos0
		stage.waterLevel = stage.newWaterLevel
		stage.waterLevel >>= 16
		object[arrayPos0].ypos = stage.newWaterLevel
	next
	if lampPostID > 31
		stage.waterState = recWaterState
		stage.waterLevel = recWaterLevel
		stage.newWaterLevel = recWaterLevel
		stage.newWaterLevel <<= 16
		arrayPos0 = Water_value31
		object[arrayPos0].ypos = stage.newWaterLevel
	else
		stage.waterState = 0
	end if
	Water_value32 = 0
	object[0].value3 = 0
	if object[0].ypos > stage.newWaterLevel
		object[0].yvel >>= 2
		object[0].xvel >>= 1
		object[0].speed >>= 1
		object[0].value20 >>= 1
		object[0].value21 >>= 1
		object[0].value22 >>= 1
		object[0].value23 >>= 1
		object[0].value24 >>= 1
		object[0].value25 = 0x1000
		if stage.playerListPos == 2
			object[0].value27 = 0x30000
		else
			object[0].value27 = 0x38000
		end if
		object[0].value28 = -0x20000
		arrayPos0 = Water_value31
		arrayPos0 += 0
		object[arrayPos0].value1 = 52
	end if
	SpriteFrame(0, -8, 256, 16, 0, 129)
	SpriteFrame(0, -8, 256, 16, 0, 146)
	SpriteFrame(0, -8, 256, 16, 0, 163)
	
	// TODO: Function 114? it's not listed in this script, at least
	BrokenMonitor_value25 = 114
end event


// ========================
// Editor Events
// ========================

event RSDKDraw
	DrawSprite(0)
end event


event RSDKLoad
	LoadSpriteSheet("LZ/Objects2.gif")
	SpriteFrame(0, -8, 256, 16, 0, 129)
	
	SetVariableAlias(ALIAS_VAR_PROPVAL, "unused")
end event
